<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whiteboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .canvas-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        canvas {
            border: 2px solid #007bff;
            border-radius: 4px;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .controls button, .controls input, .controls select {
            padding: 10px;
            font-size: 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .controls button {
            background-color: #007bff;
            color: white;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .controls button img {
            width: 20px;
            height: 20px;
        }

        .controls button:hover {
            background-color: #0056b3;
        }

        .controls input[type="color"] {
            width: 40px;
            height: 40px;
            padding: 0;
            border: none;
        }

        .controls select {
            font-size: 14px;
            padding: 5px;
        }

        .text-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .text-controls button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .text-controls button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Whiteboard</h1>
    <div class="canvas-container">
        <canvas id="whiteboard" width="800" height="600"></canvas>
        <div class="controls">
            <button onclick="setMode('draw')">
                <img src="/static/icons/pencil.png" alt="Draw">
            </button>
            <button onclick="setMode('line')">
                <img src="/static/icons/line.png" alt="Line">
            </button>
            <button onclick="setMode('rectangle')">
                <img src="/static/icons/rectangle.png" alt="Rectangle">
            </button>
            <button onclick="setMode('circle')">
                <img src="/static/icons/circle.png" alt="Circle">
            </button>
            <button onclick="setMode('triangle')">
                <img src="/static/icons/triangle.png" alt="Triangle">
            </button>
            <button onclick="setMode('erase')">
                <img src="/static/icons/eraser.png" alt="Erase">
            </button>
            <input type="color" id="color-picker" onchange="changeColor(this.value)">
            <select id="line-width" onchange="changeLineWidth(this.value)">
                <option value="2">2px</option>
                <option value="5">5px</option>
                <option value="10">10px</option>
                <option value="20">20px</option>
            </select>
        </div>
        <div class="text-controls">
            <button onclick="undo()">Geri Al</button>
            <button onclick="redo()">İleri Al</button>
            <button onclick="clearCanvas()">Temizle</button>
            <button onclick="downloadCanvas()">Kaydet</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('whiteboard');
        const ctx = canvas.getContext('2d');
        const colorPicker = document.getElementById('color-picker');
        const lineWidthSelect = document.getElementById('line-width');

        let drawing = false;
        let mode = 'draw';
        let startX, startY;
        let shapes = [];

        ctx.strokeStyle = colorPicker.value;
        ctx.lineWidth = lineWidthSelect.value;

        function changeColor(color) {
            ctx.strokeStyle = color;
        }

        function changeLineWidth(width) {
            ctx.lineWidth = width;
        }

        function setMode(selectedMode) {
            mode = selectedMode;
            if (mode === 'erase') {
                ctx.strokeStyle = '#ffffff';
            } else {
                ctx.strokeStyle = colorPicker.value;
            }
        }

        function redrawShapes() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            shapes.forEach(shape => {
                ctx.strokeStyle = shape.color;
                ctx.lineWidth = shape.lineWidth;

                if (shape.type === 'path') {
                    ctx.beginPath();
                    shape.path.forEach((point, index) => {
                        if (index === 0) {
                            ctx.moveTo(point.x, point.y);
                        } else {
                            ctx.lineTo(point.x, point.y);
                        }
                    });
                    ctx.stroke();
                } else if (shape.type === 'line') {
                    ctx.beginPath();
                    ctx.moveTo(shape.startX, shape.startY);
                    ctx.lineTo(shape.endX, shape.endY);
                    ctx.stroke();
                    ctx.closePath();
                } else if (shape.type === 'rectangle') {
                    ctx.strokeRect(shape.startX, shape.startY, shape.width, shape.height);
                } else if (shape.type === 'circle') {
                    ctx.beginPath();
                    ctx.arc(shape.startX, shape.startY, shape.radius, 0, 2 * Math.PI);
                    ctx.stroke();
                    ctx.closePath();
                } else if (shape.type === 'triangle') {
                    ctx.beginPath();
                    ctx.moveTo(shape.startX, shape.startY);
                    ctx.lineTo(shape.startX + shape.width / 2, shape.startY + shape.height);
                    ctx.lineTo(shape.startX - shape.width / 2, shape.startY + shape.height);
                    ctx.closePath();
                    ctx.stroke();
                }
            });
        }

        canvas.addEventListener('mousedown', (e) => {
            drawing = true;
            startX = e.offsetX;
            startY = e.offsetY;

            if (mode === 'draw' || mode === 'erase') {
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                currentPath = [{ x: startX, y: startY }];
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!drawing) return;

            if (mode === 'draw' || mode === 'erase') {
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
                currentPath.push({ x: e.offsetX, y: e.offsetY });
            } else {
                redrawShapes();

                const width = e.offsetX - startX;
                const height = e.offsetY - startY;

                if (mode === 'line') {
                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(e.offsetX, e.offsetY);
                    ctx.stroke();
                    ctx.closePath();
                } else if (mode === 'rectangle') {
                    ctx.strokeRect(startX, startY, width, height);
                } else if (mode === 'circle') {
                    const radius = Math.sqrt(width * width + height * height);
                    ctx.beginPath();
                    ctx.arc(startX, startY, radius, 0, 2 * Math.PI);
                    ctx.stroke();
                    ctx.closePath();
                } else if (mode === 'triangle') {
                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(startX + width / 2, startY + height);
                    ctx.lineTo(startX - width / 2, startY + height);
                    ctx.closePath();
                    ctx.stroke();
                }
            }
        });

        canvas.addEventListener('mouseup', (e) => {
            if (!drawing) return;
            drawing = false;

            const width = e.offsetX - startX;
            const height = e.offsetY - startY;

            // Yeni bir çizim yapıldığında redoStack'i temizle
            redoStack = [];

            if (mode === 'draw' || mode === 'erase') {
                shapes.push({ type: 'path', path: currentPath, color: ctx.strokeStyle, lineWidth: ctx.lineWidth });
                currentPath = [];
            } else {
                let shape;
                if (mode === 'line') {
                    shape = { type: 'line', startX, startY, endX: e.offsetX, endY: e.offsetY, color: ctx.strokeStyle, lineWidth: ctx.lineWidth };
                } else if (mode === 'rectangle') {
                    shape = { type: 'rectangle', startX, startY, width, height, color: ctx.strokeStyle, lineWidth: ctx.lineWidth };
                } else if (mode === 'circle') {
                    const radius = Math.sqrt(width * width + height * height);
                    shape = { type: 'circle', startX, startY, radius, color: ctx.strokeStyle, lineWidth: ctx.lineWidth };
                } else if (mode === 'triangle') {
                    shape = { type: 'triangle', startX, startY, width, height, color: ctx.strokeStyle, lineWidth: ctx.lineWidth };
                }
                shapes.push(shape);
            }
            redrawShapes();
        });



         function undo() {
            if (shapes.length > 0) {
                const lastShape = shapes.pop();
                redoStack.push(lastShape); // Undo edilen şekli redo için sakla
                redrawShapes();
            }
        }

        function redo() {
            if (redoStack.length > 0) {
                const shape = redoStack.pop(); // Son eklenen şekli geri al
                shapes.push(shape); // Shapes listesine ekle
                redrawShapes();
            }
        }



        function clearCanvas() {
            shapes = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function downloadCanvas() {
            const link = document.createElement('a');
            link.download = 'whiteboard.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>
</html>
